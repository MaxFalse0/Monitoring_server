<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <style>
        .hint {
            font-size: 0.9em;
            color: var(--hint);
            margin-top: 4px;
        }
        .hint.valid { color: var(--success); }
        .hint.invalid { color: var(--danger); }
        .input-group {
            position: relative;
        }
        .toggle-icon, .generate-icon {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            right: 10px;
            cursor: pointer;
            font-size: 1.2em;
            color: var(--hint);
        }
        .generate-icon {
            right: 35px;
        }
    </style>
</head>
<body>
<div class="auth-wrapper">
    <div class="auth-box">
        <h1>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h1>
        {% if error %}
            <div class="error">{{ error }}</div>
        {% endif %}
        <form method="post" onsubmit="return validateForm()">
            <div class="input-group">
                <input type="text" name="username" id="username" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" required>
                <div id="username-hint" class="hint"></div>
            </div>

            <div class="input-group">
                <input type="password" name="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" required>
                <span class="generate-icon" onclick="generatePassword()" title="–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–æ–ª—å">‚öôÔ∏è</span>
                <span class="toggle-icon" onclick="togglePassword()" title="–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–∞—Ä–æ–ª—å">üëÅ</span>
                <div id="password-hints">
                    <div class="hint" id="p-length">–ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤</div>
                    <div class="hint" id="p-uppercase">–ó–∞–≥–ª–∞–≤–Ω–∞—è –±—É–∫–≤–∞ (A-Z)</div>
                    <div class="hint" id="p-lowercase">–°—Ç—Ä–æ—á–Ω–∞—è –±—É–∫–≤–∞ (a-z)</div>
                    <div class="hint" id="p-digit">–¶–∏—Ñ—Ä–∞ (0-9)</div>
                    <div class="hint" id="p-special">–°–ø–µ—Ü—Å–∏–º–≤–æ–ª (!@#$...)</div>
                </div>
            </div>
            <button type="submit">üìù –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
        </form>
        <a href="{{ url_for('login') }}">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π—Ç–∏</a>
    </div>
</div>

<script>
    const usernameInput = document.getElementById("username");
    const usernameHint = document.getElementById("username-hint");
    const passwordInput = document.getElementById("password");

    const checks = {
        length: { el: document.getElementById("p-length"), valid: p => p.length >= 8 },
        upper: { el: document.getElementById("p-uppercase"), valid: p => /[A-Z]/.test(p) },
        lower: { el: document.getElementById("p-lowercase"), valid: p => /[a-z]/.test(p) },
        digit: { el: document.getElementById("p-digit"), valid: p => /\d/.test(p) },
        special: { el: document.getElementById("p-special"), valid: p => /[!@#$%^&*()_+{}\[\]:;"'<>,.?\\/-]/.test(p) }
    };

    function updateHints() {
        const p = passwordInput.value;
        for (const key in checks) {
            const { el, valid } = checks[key];
            el.className = "hint " + (valid(p) ? "valid" : "invalid");
        }
    }

    function updateUsernameHint() {
        const u = usernameInput.value;
        if (u.length < 4) {
            usernameHint.textContent = "–ú–∏–Ω–∏–º—É–º 4 —Å–∏–º–≤–æ–ª–∞";
            usernameHint.className = "hint invalid";
        } else if (!/^[a-zA-Z0-9_]+$/.test(u)) {
            usernameHint.textContent = "–î–æ–ø—É—Å—Ç–∏–º—ã —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ _";
            usernameHint.className = "hint invalid";
        } else {
            usernameHint.textContent = "–ò–º—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ";
            usernameHint.className = "hint valid";
        }
    }

    function validateForm() {
        updateHints();
        updateUsernameHint();

        const password = passwordInput.value;
        const username = usernameInput.value;

        const allValid = Object.values(checks).every(c => c.valid(password));
        const validUsername = username.length >= 4 && /^[a-zA-Z0-9_]+$/.test(username);

        return allValid && validUsername;
    }

    passwordInput.addEventListener("input", updateHints);
    usernameInput.addEventListener("input", updateUsernameHint);

    function togglePassword() {
        passwordInput.type = passwordInput.type === "password" ? "text" : "password";
    }

    function generatePassword() {
        const chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+-=<>?";
        let password = "";
        for (let i = 0; i < 12; i++) {
            password += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        passwordInput.value = password;
        updateHints();
    }
</script>
</body>
</html>
